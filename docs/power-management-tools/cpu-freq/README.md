# CPU 频率调节工具

## 概述

CPU 频率调节（CPU Frequency Scaling）是现代处理器的一项重要电源管理技术，通过动态调整 CPU 的运行频率来平衡性能和功耗。本工具提供了对 Linux 系统中 CPU 频率调节功能的直接控制。

## 背景知识

### P-State（性能状态）

P-State 是 ACPI（高级配置与电源接口）定义的 CPU 性能状态。每个 P-State 对应一个特定的频率和电压组合：
- P0：最高性能状态（最高频率）
- P1, P2, ...：逐渐降低的性能状态
- Pn：最低性能状态（最低频率）

### DVFS（动态电压频率调节）

DVFS 是一种通过同时调整电压和频率来优化功耗的技术。由于功耗与电压的平方成正比，降低电压可以显著减少功耗。

### Linux CPUFreq 子系统

Linux 内核通过 CPUFreq 子系统管理 CPU 频率：
- **调速器（Governor）**：决定何时以及如何调整频率的策略
- **驱动程序**：与硬件交互，实际执行频率切换
- **sysfs 接口**：用户空间访问和控制的接口

## 主要功能

### 1. 频率控制（cpu_freq_control）

提供以下功能：
- **列出可用频率**：显示 CPU 支持的所有频率
- **设置调速器**：选择频率调节策略
  - `performance`：始终运行在最高频率
  - `powersave`：始终运行在最低频率
  - `ondemand`：根据负载动态调节（快速响应）
  - `conservative`：根据负载动态调节（渐进式）
  - `schedutil`：与调度器集成的新型调速器
  - `userspace`：允许用户空间程序控制频率
- **设置频率范围**：限制最小和最大频率
- **设置特定频率**：在 userspace 调速器下设置固定频率
- **监控频率**：实时显示各 CPU 当前频率
- **统计信息**：显示各频率的使用时间

### 2. 性能基准测试（cpu_freq_benchmark）

测试不同频率下的系统性能：
- **计算性能**：GFLOPS（每秒十亿次浮点运算）
- **内存带宽**：GB/s
- **延迟**：内存访问延迟（纳秒）
- **功耗**：瓦特（需要支持的硬件）
- **能效**：GFLOPS/瓦特

## 基准测试结果解析

从提供的测试结果可以看出：

1. **频率与性能的关系**：
   - 测试频率范围：800 MHz - 3600 MHz
   - 峰值性能：3.50 GFLOPS @ 1600 MHz
   - 性能并非随频率线性增长

2. **功耗特征**：
   - 功耗相对稳定：约 71-73W
   - 表明系统可能受到其他因素限制（如内存带宽）

3. **能效分析**：
   - 最佳能效：0.05 GFLOPS/W @ 1600 MHz
   - 中等频率可能提供最佳能效比

4. **性能瓶颈**：
   - 内存带宽在 26-28 GB/s 范围内变化不大
   - 表明测试可能受内存带宽限制而非 CPU 频率

## 使用建议

1. **高性能场景**：使用 `performance` 调速器或设置高频率范围
2. **节能场景**：使用 `powersave` 或 `conservative` 调速器
3. **平衡场景**：使用 `ondemand` 或 `schedutil` 调速器
4. **基准测试**：使用 `userspace` 调速器固定频率以获得一致结果

## 注意事项

- 需要 root 权限才能修改 CPU 频率设置
- 某些系统可能通过 BIOS 或其他机制限制频率调节
- 过度降低频率可能影响系统响应性
- 长时间高频运行需要注意散热